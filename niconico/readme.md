# 说明
- xml_to_ass.py：把下载的xml文件转换成ass文件，可以直接托视频预览。
- merge_comments.py：合并一定的同屏相同内容弹幕为大号字体
- combine_twotxt.py：检测翻译后是否对应的脚本，快速得到对应文件
- function_v1.py: 对ass进行全翻译的一个工作流程。做好了重构弹幕功能，效果还可以。
- function_v1_filtertop30.py: 配合html，挑选曾出现在topxx的那些行，预先筛选出一个需要翻译的列表。再进行之后的流程。
- 目前v2比较好用了。注意事项：
  - v2是移动动画优先，时间变化不均匀。如果有些高能还没播放到关键台词就被下一个高能取代，有两种途径，一是增加bar数量可以用排位变化的动画时间延长每个高能的时间，二是降低播放速度。
  - v3有两个版本。增加均匀变化版本，为了之后原速渲染视频。
  - 如果步长调得太小会严重卡顿。0.5就比较好了。
  - 即使是均速变化的，在触发视频时还是会有小卡顿，但后期渲染不会包含视频，之后看看编辑的时候能不能吻合。
- v4 两个版本仅在动画优先处不同，分出两个ass文件，能将加入视频和音乐。
- 渲染：
  - 原理上不能
  - render.html
  - render.py
- 理解：timeStep是对数据扫描拍摄存根的间隔时间，越大数据越少。拍完后playbackSpeed（改名为PLAYWAIT了）确定以500毫秒间隔来放映这些数据，如果用视频来比喻的话，相对的卡顿，只不过3d.js帮我完成了舒适的补充。如果把它设置成例如1000/30的话，会加快播放定量的数据。如果还要保持肉眼的“原速”，需要把timeStep也调成相同值，但太小的话计算量很大，没必要。
  - python截屏似乎最高只能每秒2帧，我先也许可以通过故意增大PLAYWAIT和rankChangeAnimationDuration达到目的，正在实验中。
  - 修改：timeStep = 0.45，对应的PLAYWAIT也改为450，这就是原速。
- timeStep 决定数据精细度，和播放速度时间等完全无关。

```
特性 (Feature)	timeStep (数据步长)	playbackSpeed (播放速度)
作用阶段	数据预处理 (加载文件时)	实时动画播放 (点击播放后)
比喻	电影的拍摄频率 (决定内容)	电影的放映速度 (决定观感)
决定了什么	数据的精细度和内容	动画的视觉快慢
影响对象	keyframes 数组的内容	setTimeout 的延迟时间
何时生效	一次性生效，生成数据	播放期间，可持续改变
```

- 流程记录：利用日本人做的扩展下载弹幕xml格式，filter_xmlmulti.py 把同一id的重复弹幕去掉；用function_v1跑流程，优先翻译多次出现的弹幕，更新词典；把代翻译的给AI翻译，一次1000条左右，太多会卡死。回填后基本完成。
- 以后的规划：如果还要利用这套流程，待改善的点，把弹幕重构功能用最开始xml_to_ass代替并合并到function里，因为v1版本考虑了特殊弹幕的位置保留，可以保留艺术弹幕，而重构弹幕这个功能没有考虑。还有把过滤和大块合并功能也合并到function里会比较好。
- 备注：niconico的艺术弹幕可以有多行，可以检查下我的代码里对空行和空格的处理，保留更好，注意想一下词典那里怎么改比较好。