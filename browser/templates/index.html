<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件系统媒体浏览器</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="header-container">
        <div class="header">
            <div class="header-controls">
                <select id="mode-selector" class="button">
                    <option value="MANGA">MANGA</option>
                    <option value="JAV">JAV</option>
                    <option value="ANIME">ANIME</option>
                    <option value="MUSIC">MUSIC</option>
                    <option value="NOVEL">NOVEL</option>
                    <option value="OTHER">OTHER</option>
                </select>
                <input type="text" id="search-input" placeholder="输入关键词搜索...">
                <button id="search-btn" class="button">搜索</button>
                <button id="stats-btn" class="button">统计</button>
            </div>
            <div class="header-right-controls">
                <div class="maintenance-container" style="position: relative;">
                    <button id="maintenance-btn" class="button">维护</button>
                    <div id="maintenance-menu">
                        <button id="generate-covers-btn" class="button">生成封面</button>
                        <button id="edit-tags-btn" class="button">编辑Tag</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="nav-frame">
        <button id="back-btn" class="button" style="margin-right: 10px; display: none;">返回</button>
        <span id="current-path-label">正在加载...</span>
    </div>
    
    <div id="browse-view" class="main-content">
        <div id="media-container" class="manga-mode"></div>
        <button id="open-folder-btn" class="button open-folder-btn">打开所在目录</button>
    </div>
    
    <div id="stats-view" class="main-content" style="display: none;">
        <div class="stats-header">
             <h1>作品访问统计</h1>
        </div>
        <div id="stats-container"></div>
    </div>
    
    <div id="loading-indicator">正在加载...</div>

    <div id="image-viewer" class="overlay">
        <span id="fullscreen-btn">⛶</span>
        <span class="close-btn">&times;</span>
        <div class="image-container">
            <img id="current-image" src="" alt="viewer image">
        </div>
        <div id="progress-bar-container" class="progress-bar"></div>
    </div>
    <div id="epub-viewer" class="overlay">
        <div id="epub-top-bar">
            <span class="close-btn">&times;</span>
        </div>
        <div id="epub-area-wrapper">
            <div id="epub-area"></div>
        </div>
        <div id="epub-bottom-bar">
            <button id="prev-page-btn" class="button">&lt; 上一页</button>
            <button id="next-page-btn" class="button">下一页 &gt;</button>
        </div>
    </div>
    <div id="video-player" class="overlay">
        <span class="close-btn">&times;</span>
        <video id="current-video" controls autoplay></video>
    </div>
    <div id="album-view" class="overlay">
        <span class="close-btn">&times;</span>
        <div class="album-info">
            <img id="album-art-img" src="" class="album-art">
            <h2 id="album-title-text" class="album-title"></h2>
        </div>
        <div class="track-list-container">
            <ol id="track-list-ui" class="track-list"></ol>
        </div>
        <div id="music-player-controls">
            <div class="control-buttons">
                <button id="shuffle-btn" class="control-button" title="随机播放">随机已关</button>
                <button id="prev-btn" class="control-button">上一首</button>
                <button id="play-pause-btn" class="control-button play-pause">播放</button>
                <button id="next-btn" class="control-button">下一首</button>
                <button id="repeat-btn" class="control-button" title="循环模式">顺序播放</button>
            </div>
            <audio id="current-audio-player" controls></audio>
        </div>
    </div>
    <div id="anime-view" class="overlay">
        <span class="close-btn">&times;</span>
        <div class="anime-player-container">
            <div id="anime-video-wrapper">
                <video id="current-anime-video" controls autoplay>
                    <track kind="subtitles" srclang="zh" label="Default Subtitles">
                </video>
            </div>
            <div id="anime-controls-wrapper">
                 <button id="toggle-subtitle-btn" class="button">隐藏字幕</button>
                 <select id="subtitle-selector-btn" class="button" style="display: none;"></select>
            </div>
        </div>
        <div class="episode-list-container">
            <h2 id="anime-title-text"></h2>
            <ol id="episode-list-ui" class="episode-list"></ol>
        </div>
    </div>
    <template id="card-template">
        <div class="card">
            <div class="card-image-wrapper">
                <img>
                <span class="placeholder-text"></span>
            </div>
            <div class="card-info">
                <div class="card-filename"></div>
                <div class="card-tags"></div>
            </div>
        </div>
    </template>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
</body>
</html>